---
title: 3/31 蚂蚁集团Java一面，不只是技术问题，还有系统设计的深度拷问！
urlname: ye5hk2gzoaeh95us
date: '2024-06-13 21:14:41'
updated: '2024-06-13 21:14:49'
cover: 'https://cdn.nlark.com/yuque/0/2024/png/22382235/1711544256669-3e7e0807-93ea-4e27-93bc-66acaaf67b7c.png'
description: 'https://www.nowcoder.com/discuss/601794045181997056下面我将分享一位同学在蚂蚁集团Java一面的面试经历，他的评价是，面试过程中问题很深入，你试试呢？【提醒】通过这次面试经验，你将可以复习到以下知识点：线程池的工作原理、参数配置及使用注意事项C...'
---
[https://www.nowcoder.com/discuss/601794045181997056](https://www.nowcoder.com/discuss/601794045181997056)

下面我将分享一位同学在蚂蚁集团Java一面的面试经历，他的评价是，面试过程中问题很深入，你试试呢？

【提醒】通过这次面试经验，你将可以复习到以下知识点：

1. 线程池的工作原理、参数配置及使用注意事项
2. CPU密集型和I/O密集型任务在线程池配置上的不同
3. 服务器核心数与线程池核心线程数的关系
4. Redis的使用场景和内存淘汰机制
5. 面对高并发情况下的应急解决方法和长期优化方案
6. 系统设计相关的性能计算和扩容策略

面试开始！
![interview_start.png](https://oss1.aistar.cool/elog-offer-now/9ed837b5c3e50a351885d3c717a4b20e.png)
**面试官**: 你好，我们直接进入问题，你对线程池了解吗？

**求职者**: 是的，线程池是一种线程使用模式，可以有效地减少线程创建和销毁的开销，实现线程的复用。

**面试官**: 那你能说说线程池的参数有哪些，以及它们是怎么工作的吗？

**求职者**: 线程池的主要参数包括核心线程数(corePoolSize)、最大线程数(maximumPoolSize)、空闲线程存活时间(keepAliveTime)、时间单位(TimeUnit)、工作队列(BlockingQueue)等。核心线程数是线程池中始终存活的线程数，即使它们处于空闲状态也不会被回收。最大线程数是线程池中允许同时运行的最大线程数量。空闲线程存活时间是当线程数超过核心线程数时，多余的空闲线程等待新任务的最长时间，超过这个时间就会被回收。工作队列用于存放待执行的任务。

**面试官**: 那线程池的参数值你是如何考虑的？

**求职者**: 核心线程数的设置通常取决于任务的类型。对于I/O密集型任务，由于线程经常会因I/O操作被阻塞，所以可以设置更多的线程，例如CPU核心数的两倍。而对于CPU密集型任务，线程数应该尽量少，通常设置为CPU核心数加1以避免上下文切换带来的开销。

**面试官**: 如果是CPU密集型任务，你把线程数设置成2N会有什么问题？

**求职者**: 如果CPU密集型任务的线程数设置得太多，比如2N，那么就会有太多线程同时竞争CPU资源，导致上下文切换增多，CPU资源不能得到充分利用，反而可能降低了程序的整体性能。

**面试官**: 非常好。给你一个8核的服务器，线程池设置了8个核心线程数，20个总线程数，QPS为20，每个线程执行1s，执行流程是什么？

**求职者**: 在这种情况下，每秒钟会有20个请求进来。因为核心线程数是8，所以会有8个请求直接分配给8个核心线程处理。剩下的12个请求会进入工作队列等待。如果队列是有界的，那么它会根据队列的容量来存储这些任务，一旦队列满了，就会创建额外的线程来处理更多的任务，直到线程数达到最大线程数20。如果1秒钟内所有任务都能完成，那么不会有任务在队列中等待太久，也不会有太多线程被创建。

**面试官**: 好的，我们来切换到另一个话题。你使用Redis的场景是什么？

**求职者**: 我在项目中使用Redis来实现用户的共同关注功能，主要是因为Redis提供了快速的读写能力，适合这种需要频繁查询和更新的场景。

**面试官**: Redis的内存淘汰机制你了解吗？

**求职者**: 是的，Redis提供了多种内存淘汰策略，比如无淘汰(no eviction)，随机淘汰(random)，最少使用淘汰(least recently used, LRU)，最少访问淘汰(least frequently used, LFU)等。当Redis使用的内存超过了配置的maxmemory限制时，根据设定的淘汰策略来移除一些键，以释放内存空间。

**面试官**: 如果用户量突增，内存超限了，你会怎么办？

**求职者**: 如果发生这种情况，首先，我会采取应急措施，比如暂时将共同关注功能的数据存储转移到MySQL来处理，以避免服务完全不可用。中期来看，我会考虑优化Redis的数据存储结构，检查是否有数据设计上的缺陷，有没有更高效的数据结构可以使用。长期来看，如果用户规模持续增长，我会考虑搭建Redis集群，实现更好的扩展性和高可用性。

**面试官**: 对了，在讨论Redis的问题时，我们还提到了QPS的计算。你能简单解释一下如何计算QPS吗？ 

**求职者**: 当然，QPS即每秒查询率，它是衡量服务器处理能力的一个指标。计算QPS的方法是在一个给定的时间窗口内统计请求的总数，然后除以这个时间窗口的秒数。比如，如果在10秒内服务端接收到了200个请求，那么QPS就是200除以10，等于20。

 **面试官**: 明白了。你之前提到了，在遇到Redis内存超限的情况下，你会采取一些应急措施。那你能说说如果这种情况发生了，你具体该怎么操作吗？

 **求职者**: 如果Redis内存超限发生了，首先我会查看当前Redis服务器的内存使用情况，确认是否有异常大量的请求或数据存储导致超限。接下来，我会检查内存淘汰策略是否合理配置，以及是否有不必要的大key占用大量内存。如果确认是因为业务量增加导致的超限，那么我会立即调整Redis配置，比如增加maxmemory的设置，或者临时关闭一些非关键功能减轻内存压力。然后，我会根据业务需求评估并实施中长期的优化措施。

**面试官**: 那么，如果你的共同关注功能使用了Redis存储，而用户量突增导致内存超限，你的长期解决方法是什么？ 

**求职者**: 针对长期解决方法，我会从以下几个方面着手： 
A. 分析当前的数据模型，看看是否有优化空间，比如使用Redis的数据结构如Sorted Sets、Hashes或Bitmaps来减少内存占用；
 B. 实施数据分片，将数据分散到多个Redis实例中去，这样可以分散内存压力； 
C. 构建Redis集群，通过搭建集群来提高系统的扩展性和容错能力，同时使用一致性哈希等技术来保证数据的均匀分布； 
D. 引入缓存淘汰策略，定期淘汰不常用的数据，或者对数据设置过期时间来自动淘汰；
 E. 监控和预警机制的增强，实时监控Redis的内存使用情况，一旦接近阈值就触发预警，及时处理可能的问题。 

**面试官**: 你在实习项目中有处理过高流量的情况吗？ 

**求职者**: 实话说，我在实习项目中并没有处理过非常高流量的情况。不过我理解，在设计系统时需要考虑到扩展性和高可用性，以便在流量激增时系统能够稳定运行。如果遇到高流量的情况，我会从负载均衡、数据库分库分表、缓存优化等方面来优化系统。

**面试官**: 在我们结束之前，我想问一下，你是否有科研或者论文经历？如果有，你能不能简单介绍一下？

 **求职者**: 是的，我有参与科研项目和编写论文的经验。我的研究主要集中在[请描述你的科研主题]。在这个项目中，我主要负责[请描述你的具体工作和贡献]。这个经历让我学会了如何进行科学研究，以及如何将理论知识应用于实际问题解决中。 

**面试官**: 很好，这些经历对于深入理解技术原理肯定很有帮助。关于实习项目，你能不能更详细地介绍一下你们的用户量和服务器配置，以及如何根据这些因素来决定线程池大小？ 

**求职者**: 关于我的实习项目，用户量大概是[请提供用户量的大致范围]，我们服务器的配置包括[请描述服务器的具体配置，如CPU核心数、内存大小等]。在决定线程池大小时，我们会根据服务器的配置和预期的QPS来进行评估。我们会考虑到核心线程数应该保持服务器CPU的充分利用，同时避免过多的线程导致频繁的上下文切换。另外，我们也会设置合理的工作队列大小和最大线程数，以确保在用户量激增时，系统还能有足够的处理能力，同时也要避免OOM等风险。 

**面试官**: 好的，看来你对线程池的配置有一定的理解。那么，假如用户量突然大幅增加，你们的服务器能够承受多少QPS？你会如何计算？ 

**求职者**: 这个问题涉及到系统的性能评估，首先需要知道现有服务器处理单个请求的平均时间，以及系统的并发处理能力。假设每个请求的平均处理时间是[请提供时间]，那么一个核心线程每秒可以处理的请求数是1除以这个时间。然后，根据核心线程数和最大线程数，我们可以大致估算出系统的最大QPS。当然，这个计算是理论上的，实际情况可能会受到网络延迟、数据库性能等多种因素的影响。 

**面试官**: 好的，非常感谢你的回答。在面试过程中，你展现出了对技术的理解和应用能力。如果有后续的面试安排，我们会及时与你联系。希望你能从这次面试中获得宝贵的经验。祝你好运，再见。 

**求职者**: 非常感谢这次面试的机会，期待后续的消息。再见。
